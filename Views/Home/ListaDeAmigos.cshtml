@using OldMates.Models 
@{
    List<Usuario> Amigos = ViewBag.Amigos;
    List<Amistad> Solicitudes = ViewBag.SolicitudesPendientes;
    Usuario usuario = ViewBag.Usuario;
}

<div class="carrusel-actividades">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="title mb-0">Mis Amigos</h2>
        <a class="btn btn-success" href="@Url.Action("BuscarAmigos", "Home")">+ Buscar Personas</a>
    </div>

    @if (Solicitudes != null && Solicitudes.Count > 0)
    {
        <h3 style="font-size: 18px; color: #666; margin-bottom: 15px;">Solicitudes Pendientes</h3>
        <div class="swiper solicitudesSwiper mb-5">
            <div class="swiper-wrapper">
                @foreach (var solicitud in Solicitudes)
                {
                    <div class="swiper-slide">
                        <div class="card-actividad card-solicitud-pequena">
                            <div class="card-actividad-img img-solicitud-pequena">
                                <img src="@(solicitud.Usuario1.Foto ?? "/img/usuario_default.png")" alt="@solicitud.Usuario1.Nombre">
                            </div>
                            <div class="card-actividad-body">
                                <div>
                                    <h5 style="font-size: 16px;">@solicitud.Usuario1.Nombre @solicitud.Usuario1.Apellido</h5>
                                    <p style="font-size: 13px; color: #888;">Solicitud de amistad</p>
                                    <div class="card-actividad-info">
                                        <p style="font-size: 13px;"><strong>Localidad:</strong> @solicitud.Usuario1.Localidad</p>
                                        <p style="font-size: 13px;"><strong>Intereses:</strong> @solicitud.Usuario1.Intereses</p>
                                    </div>
                                </div>
                                <div class="card-actividad-actions">
                                    <form action="@Url.Action("AceptarSolicitud", "Home")" method="post" style="display:inline;">
                                        <input type="hidden" name="IDSolicitud" value="@solicitud.ID" />
                                        <button type="submit" class="btn btn-success btn-sm">Aceptar</button>
                                    </form>
                                    <form action="@Url.Action("RechazarSolicitud", "Home")" method="post" style="display:inline;">
                                        <input type="hidden" name="IDSolicitud" value="@solicitud.ID" />
                                        <button type="submit" class="btn btn-danger btn-sm">Rechazar</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-pagination"></div>
        </div>
    }

    @if (Amigos != null && Amigos.Count > 0)
    {
        <h3 style="font-size: 24px; color: #021F59; margin-bottom: 20px; font-weight: bold;">Tus Amigos</h3>
        <div class="swiper amigosSwiper">
            <div class="swiper-wrapper">
                @foreach (var amigo in Amigos)
                {
                    <div class="swiper-slide">
                        <div class="card-actividad card-amigo-grande">
                            <div class="card-actividad-img img-amigo-grande">
                                <img src="@(amigo.Foto ?? "/img/usuario_default.png")" alt="@amigo.Nombre">
                            </div>
                            <div class="card-actividad-body">
                                <div>
                                    <h5 style="font-size: 22px; font-weight: bold;">@amigo.Nombre @amigo.Apellido</h5>
                                    <p style="font-size: 16px; color: #007CB5;">@amigo.Username</p>
                                    <div class="card-actividad-info">
                                        <p style="font-size: 15px;"><strong>Localidad:</strong> @amigo.Localidad</p>
                                        <p style="font-size: 15px;"><strong>Intereses:</strong> @amigo.Intereses</p>
                                    </div>
                                </div>
                                <div class="card-actividad-actions">
                                    <form action="@Url.Action("EliminarAmigo", "Home")" method="post" style="display:inline;" 
                                          onsubmit="return confirm('¿Estás seguro de eliminar a @amigo.Nombre de tus amigos?');">
                                        <input type="hidden" name="IDAmigo" value="@amigo.ID" />
                                        <button type="submit" class="btn btn-danger">Eliminar</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-pagination"></div>
        </div>
    }
    else
    {
        <p class="empty-message text-center">No tienes amigos registrados.</p>
    }
</div>


@if ((Solicitudes != null && Solicitudes.Count > 0) || (Amigos != null && Amigos.Count > 0))
{
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            try {
                if (typeof Swiper === 'undefined') {
                    console.error('Swiper.js no está cargado');
                    return;
                }
                
                @if (Solicitudes != null && Solicitudes.Count > 0)
                {
                    <text>
                    var swiper = new Swiper(".solicitudesSwiper", {
                        slidesPerView: 1,
                        spaceBetween: 30,
                        loop: false,
                        navigation: {
                            nextEl: ".swiper-button-next",
                            prevEl: ".swiper-button-prev",
                        },
                        pagination: {
                            el: ".swiper-pagination",
                            clickable: true,
                            dynamicBullets: true,
                        },
                        speed: 500,
                    });
                    
                    if (!swiper) {
                        console.error('Error al inicializar Swiper de solicitudes');
                    }
                    </text>
                }
                
                @if (Amigos != null && Amigos.Count > 0)
                {
                    <text>
                    var swiper = new Swiper(".amigosSwiper", {
                        slidesPerView: 1,
                        spaceBetween: 30,
                        loop: false,
                        navigation: {
                            nextEl: ".swiper-button-next",
                            prevEl: ".swiper-button-prev",
                        },
                        pagination: {
                            el: ".swiper-pagination",
                            clickable: true,
                            dynamicBullets: true,
                        },
                        speed: 500,
                    });
                    
                    if (!swiper) {
                        console.error('Error al inicializar Swiper de amigos');
                    }
                    </text>
                }
            } catch (error) {
                console.error('Error en carrusel de amigos:', error);
            }
        });
    </script>
}
