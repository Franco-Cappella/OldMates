@using OldMates.Models
@{
    ViewData["Title"] = "Buscar Amigos";
    List<Usuario> usuarios = ViewBag.Usuarios as List<Usuario> ?? new List<Usuario>();
    string busqueda = ViewBag.Busqueda as string ?? "";
    Usuario usuarioActual = ViewBag.Usuario;
}

<div class="carrusel-actividades">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="title mb-0">Buscar Personas</h2>
        <a class="btn btn-success" href="@Url.Action("ListaDeAmigos", "Home")">
            <i class="bi bi-people"></i> Mis Amigos
        </a>
    </div>

    <form action="@Url.Action("BuscarAmigos", "Home")" method="get" class="mb-4">
        <div class="input-group input-group-lg">
            <input type="text" name="busqueda" value="@busqueda" 
                   placeholder="Buscar por nombre, apellido o usuario..." 
                   class="form-control" />
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-search"></i> Buscar
            </button>
        </div>
    </form>

    @if (!string.IsNullOrEmpty(busqueda))
    {
        <h3 class="subtitle mb-3">
            Resultados para "@busqueda" 
            <span class="badge bg-info">@usuarios.Count encontrados</span>
        </h3>

        @if (usuarios.Count == 0)
        {
            <p class="empty-message text-center">No se encontraron personas. Probá con otro nombre.</p>
        }
        else
        {
            <div class="swiper buscarSwiper">
                <div class="swiper-wrapper">
                    @foreach (var u in usuarios)
                    {
                        string estadoAmistad = u.Intereses;
                        <div class="swiper-slide">
                            <div class="card-actividad">
                                <div class="card-actividad-img">
                                    <img src="@(u.Foto ?? "/img/usuario_default.png")" alt="@u.Nombre">
                                </div>
                                <div class="card-actividad-body">
                                    <div>
                                        <h5>@u.Nombre @u.Apellido</h5>
                                        <div class="card-actividad-info">
                                            <span><strong>Localidad:</strong> @(u.Localidad ?? "Sin ubicación")</span>
                                            <span><strong>Username:</strong> @u.Username</span>
                                        </div>
                                    </div>
                                    <div class="card-actividad-actions">
                                        @if (estadoAmistad == "aceptada")
                                        {
                                            <button class="btn btn-success" disabled>
                                                <i class="bi bi-check-circle-fill"></i> Ya son amigos
                                            </button>
                                        }
                                        else if (estadoAmistad == "pendiente")
                                        {
                                            <button class="btn btn-warning" disabled>
                                                <i class="bi bi-clock"></i> Solicitud enviada
                                            </button>
                                        }
                                        else
                                        {
                                            <form action="@Url.Action("EnviarSolicitudAmistad", "Home")" method="post" style="display:inline;">
                                                <input type="hidden" name="IDAmigo" value="@u.ID" />
                                                <button type="submit" class="btn btn-primary">
                                                    <i class="bi bi-person-plus"></i> Agregar Amigo
                                                </button>
                                            </form>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-pagination"></div>
            </div>
        }
    }
</div>

@if (!string.IsNullOrEmpty(busqueda) && usuarios.Count > 0)
{
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            try {
                if (typeof Swiper === 'undefined') {
                    console.error('Swiper.js no está cargado');
                    return;
                }
                
                var swiperBuscar = new Swiper(".buscarSwiper", {
                    slidesPerView: 1,
                    spaceBetween: 30,
                    loop: false,
                    navigation: {
                        nextEl: ".swiper-button-next",
                        prevEl: ".swiper-button-prev",
                    },
                    pagination: {
                        el: ".swiper-pagination",
                        clickable: true,
                        dynamicBullets: true,
                    },
                    speed: 500,
                });
            } catch (error) {
                console.error('Error en carrusel de búsqueda:', error);
            }
        });
    </script>
}
