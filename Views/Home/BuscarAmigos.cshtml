@using OldMates.Models
@{
    ViewData["Title"] = "Buscar Amigos";
    List<Usuario> Usuarios = ViewBag.Usuarios as List<Usuario> ?? new List<Usuario>();
    string Busqueda = ViewBag.Busqueda as string ?? "";
    Usuario UsuarioActual = ViewBag.Usuario;
}

<div class="carrusel-actividades">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="title mb-0">Buscar Personas</h2>
        <a class="btn btn-success" href="@Url.Action("ListaDeAmigos", "Home")">Mis Amigos</a>
    </div>

    <form action="@Url.Action("BuscarAmigos", "Home")" method="get" class="mb-4">
        <div class="input-group input-group-lg">
            <input type="text" name="busqueda" value="@Busqueda" 
                   placeholder="Buscar por nombre, apellido o usuario..." 
                   class="form-control" />
            <button type="submit" class="btn btn-primary">Buscar</button>
        </div>
    </form>

    @if (!string.IsNullOrEmpty(Busqueda))
    {
        @if (Usuarios != null && Usuarios.Count > 0)
        {
            <div class="swiper buscarSwiper">
                <div class="swiper-wrapper">
                    @foreach (var u in Usuarios)
                    {
                        string estadoAmistad = u.Intereses;
                        <div class="swiper-slide">
                            <div class="card-actividad">
                                <div class="card-actividad-img">
                                    <img src="@(u.Foto ?? "/img/usuario_default.png")" alt="@u.Nombre">
                                </div>
                                <div class="card-actividad-body">
                                    <div>
                                        <h5>@u.Nombre @u.Apellido</h5>
                                        <p>@u.Username</p>
                                        <div class="card-actividad-info">
                                            <span><strong>Localidad:</strong> @(u.Localidad ?? "Sin ubicación")</span>
                                        </div>
                                    </div>
                                    <div class="card-actividad-actions">
                                        @if (estadoAmistad == "aceptada")
                                        {
                                            <a class="btn btn-secondary" disabled>Ya son amigos</a>
                                        }
                                        else if (estadoAmistad == "pendiente")
                                        {
                                            <a class="btn btn-warning" disabled>Solicitud enviada</a>
                                        }
                                        else
                                        {
                                            <form action="@Url.Action("EnviarSolicitudAmistad", "Home")" method="post">
                                                <input type="hidden" name="IDAmigo" value="@u.ID" />
                                                <button type="submit" class="btn btn-primary">Agregar</button>
                                            </form>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-pagination"></div>
            </div>
        }
        else
        {
            <p class="empty-message text-center">No se encontraron personas.</p>
        }
    }
</div>

@if (!string.IsNullOrEmpty(Busqueda) && Usuarios != null && Usuarios.Count > 0)
{
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            try {
                if (typeof Swiper === 'undefined') {
                    console.error('Swiper.js no está cargado');
                    return;
                }
                
                var swiper = new Swiper(".buscarSwiper", {
                    slidesPerView: 1,
                    spaceBetween: 30,
                    loop: false,
                    navigation: {
                        nextEl: ".swiper-button-next",
                        prevEl: ".swiper-button-prev",
                    },
                    pagination: {
                        el: ".swiper-pagination",
                        clickable: true,
                        dynamicBullets: true,
                    },
                    speed: 500,
                });
                
                if (!swiper) {
                    console.error('Error al inicializar Swiper de búsqueda');
                }
            } catch (error) {
                console.error('Error en carrusel de búsqueda:', error);
            }
        });
    </script>
}
